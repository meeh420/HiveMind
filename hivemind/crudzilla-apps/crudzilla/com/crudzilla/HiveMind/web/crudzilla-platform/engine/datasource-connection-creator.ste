{"definition_id":"74ad01bb-bb29-436c-b5f8-eba6a3bf1448","last_refresh_timestamp":1392578176460,"postexecution_handlers":[],"definition":{"id":"74ad01bb-bb29-436c-b5f8-eba6a3bf1448","code":"import java.util.Map;\n\nif(dataSourceConfig.type.compareTo(\"jndi\") == 0){\n  \tjavax.naming.Context initContext = new javax.naming.InitialContext();\n  \tjavax.sql.DataSource dataSource = (javax.sql.DataSource)initContext.lookup(/*\"java:comp/env/\"+*/dataSourceConfig.jndiPath);\n  \treturn dataSource.getConnection();\n}\nelse\nif(dataSourceConfig.type.compareTo(\"datasource-bean\") == 0){\n  \tjava.lang.Object dataSourceBean = java.lang.Class.forName(dataSourceConfig.className).newInstance();\n  \torg.apache.commons.beanutils.BeanUtilsBean.getInstance().populate(dataSourceBean,dataSourceConfig.dataSource);\n  \treturn ((javax.sql.DataSource)dataSourceBean).getConnection();\n}\nelse\nif(dataSourceConfig.type.compareTo(\"jdbc-driver\") == 0){\n    //load driver if necessary\n    if(dataSourceConfig.driverClassName != null && !dataSourceConfig.driverClassName.isEmpty())\n          Class.forName(dataSourceConfig.driverClassName);    \n    \n\tjava.util.Properties connectionProps = new java.util.Properties();\n    if(dataSourceConfig instanceof org.apache.commons.beanutils.LazyDynaBean){\n        for (Map.Entry<String, Object> entry : dataSourceConfig.getMap().entrySet()) { \n          String key = entry.getKey();\n          Object value = entry.getValue();\n          connectionProps.put(key, value);\n        }\n    }\n    else\n    {  \t\n      if(dataSourceConfig.userName != null && !dataSourceConfig.userName.isEmpty())\n          connectionProps.put(\"user\", dataSourceConfig.userName);\n      \n      if(dataSourceConfig.passWord != null && !dataSourceConfig.passWord.isEmpty())\n      \tconnectionProps.put(\"password\", dataSourceConfig.passWord);       \n    }\n    return java.sql.DriverManager.getConnection(dataSourceConfig.url,connectionProps);\n}\nreturn null;","name":"datasource-connection-creator","description":"","crudType":"scriptexecutor","type":"groovy","serverSideOnly":"yes","requireAllIdentities":null,"lastModifiedTimeStamp":"1374890902773"},"preexecution_handlers":[],"execution_parameters":[],"reference_id":"754ea463-0802-4eb2-8ccb-73ab4b160cd7","accesscontrols":[]}