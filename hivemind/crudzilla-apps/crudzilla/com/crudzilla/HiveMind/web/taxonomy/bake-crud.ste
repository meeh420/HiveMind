{"definition_id":"394293dd-6b1f-4d37-a0a2-f27252aab6da","last_refresh_timestamp":1393271945922,"postexecution_handlers":[],"definition":{"id":"394293dd-6b1f-4d37-a0a2-f27252aab6da","code":"import java.util.List;\nimport java.io.File;\n\ndef attachTransaction(c){\n  Object transaction  = httpRequest.getSession().getAttribute(\"crudzilla_transaction_object\");\n  \n  if(transaction != null){\n    //Object action  = httpRequest.getSession().getAttribute(\"crudzilla_transaction_action\");\n    c.getArguments().put(\"crudzilla_transaction_object\",transaction);\n    c.getArguments().put(\"crudzilla_transaction_\"+transaction.get(\"name\"),httpRequest.getSession().getAttribute(\"crudzilla_transaction_\"+transaction.get(\"name\")));\n    c.getArguments().put(\"crudzilla_transaction_action\",\"join\");\n  }\n  return c;\n}\n\ndef deWindowize(String path){\n   String normalizePath = path.replace(\"\\\\\",\"/\");   \n  \n   //remove windows drive letter part of the path\n   if(normalizePath.indexOf(':') != -1)\n      normalizePath = normalizePath.substring(normalizePath.indexOf(':')+1);  \n  \n   return normalizePath;\n}\n\n\ndef runCrud(){\n  try\n  {\n      crud.logger().info(\"taxonomyPath:\"+(parent_id == '0'?deWindowize(new File(relPath).getCanonicalPath()):relPathFrom))\n      crud.logger().info(\"type:\"+type);\n      Object appTaxonomy = crud.add(\"createPath\",\"false\")\n    \t\t.add(\"type\",type)\n    \t\t.add(\"parent_id\",parent_id)\n    \t\t.add(\"taxonomyPath\",relPath/*parent_id == '0'?deWindowize(new File(relPath).getCanonicalPath()):relPathFrom*/)\n    \t\t.call(findAppTaxonomy);\n    \n      //Object appTaxonomy = crud.add(\"id\",id).call(getAppTaxonomy).get(0);\n      crud.logger().info(\"baking:\"+relPath+\"(\"+appTaxonomy.linkId+\")\");\n      crud.logger().info(\"type:\"+appTaxonomy.type);\n    \n      if(appTaxonomy.type.compareTo(\"apptaxonomy-category\") != 0){\n          String mime = crud.call(\"crud-mime.ins\").get(appTaxonomy.type);\n\n\t\t\tcrud\n              .add(\"relPath\",\"/\"+relPath+\".\"+mime/*deWindowize(new File(\"/\"+relPath+\".\"+mime).getCanonicalPath())*/)\n              .add(\"definition_id\",appTaxonomy.linkId)\n              .call(\"bake.ste\");        \n      }\n      else\n      {\n          List childTaxonomies = attachTransaction(crud.add(\"parent_id\",appTaxonomy.id))\n        .call(getAppTaxonomys);       \n              \n          //iterate through each node and bake it\n          for(Object taxonomy: childTaxonomies){   \n            String newRelPath = relPath+\"/\"+taxonomy.name;    \n            \n            //recursive call\n            crud.add(\"relPath\",newRelPath/*deWindowize(new File(newRelPath).getCanonicalPath())*/).add(\"type\",taxonomy.type).call(bakeCrud);\n          }\n      }\n  }catch(Exception ex){\n  \tcrud.logger().error(\"error baking crud \"+relPath,ex);\n  }\n}\n\nrunCrud();","name":"bake-crud","description":"","crudType":"scriptexecutor","type":"groovy","serverSideOnly":"no","requireAllIdentities":null,"lastModifiedTimeStamp":"1393271941867"},"preexecution_handlers":[],"execution_parameters":[{"id":"f53e9e6a-ea15-4a2c-8d92-92c761406a1f","definitionId":"394293dd-6b1f-4d37-a0a2-f27252aab6da","required":"no","name":"findChildTaxonomy","type":"crud","validationRegEx":"","defaultValue":"/taxonomy/find-category-children.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"yes","position":"0"},{"id":"ee81af48-68e8-4a69-9e1e-3f0d031d1b0a","definitionId":"394293dd-6b1f-4d37-a0a2-f27252aab6da","required":"no","name":"findAppTaxonomy","type":"crud","validationRegEx":"","defaultValue":"/taxonomy/find-category.ste","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"yes","position":"0"},{"id":"e49971bc-e987-4f31-8a5c-90801975b908","definitionId":"394293dd-6b1f-4d37-a0a2-f27252aab6da","required":"no","name":"getAppTaxonomy","type":"crud","validationRegEx":"","defaultValue":"../api/app-taxonomy/get-apptaxonomy.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"yes","position":"0"},{"id":"ded9097d-5507-425c-9c96-fc2e369061f7","definitionId":"394293dd-6b1f-4d37-a0a2-f27252aab6da","required":"no","name":"getAppTaxonomys","type":"crud","validationRegEx":"","defaultValue":"../api/app-taxonomy/get-apptaxonomys.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"yes","position":"0"},{"id":"ca070492-da2a-434e-b1e1-33f167f0d6b6","definitionId":"394293dd-6b1f-4d37-a0a2-f27252aab6da","required":"no","name":"taxonomyPath","type":"string","validationRegEx":"","defaultValue":"","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"no","position":"0"},{"id":"c188ba3d-d8d3-4de4-acdf-2542077468bd","definitionId":"394293dd-6b1f-4d37-a0a2-f27252aab6da","required":"no","name":"bakeCrud","type":"crud","validationRegEx":"","defaultValue":"/taxonomy/bake-crud.ste","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"yes","position":"0"},{"id":"af76d3d7-8bc3-4efb-8679-53f62cd35d15","definitionId":"394293dd-6b1f-4d37-a0a2-f27252aab6da","required":"no","name":"type","type":"string","validationRegEx":"","defaultValue":"","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"no","position":"7"},{"id":"ef3d2d2f-349f-48e2-9750-df9329318f89","definitionId":"394293dd-6b1f-4d37-a0a2-f27252aab6da","required":"no","name":"parent_id","type":"string","validationRegEx":"","defaultValue":"0","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"no","position":"8"}],"reference_id":"ed4d9605-83dc-45db-b393-d99ca1c5cbdc","accesscontrols":[]}