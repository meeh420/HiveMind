{"definition_id":"0fbb8848-48df-4380-ad7d-6b01bef06ebf","last_refresh_timestamp":1392941108427,"postexecution_handlers":[],"definition":{"id":"0fbb8848-48df-4380-ad7d-6b01bef06ebf","code":"import java.util.List;\n\ndef attachTransaction(c){\n  Object transaction  = httpRequest.getSession().getAttribute(\"crudzilla_transaction_object\");\n  \n  if(transaction != null){\n    c.getArguments().put(\"crudzilla_transaction_object\",transaction);\n    c.getArguments().put(\"crudzilla_transaction_\"+transaction.get(\"name\"),httpRequest.getSession().getAttribute(\"crudzilla_transaction_\"+transaction.get(\"name\")));\n    c.getArguments().put(\"crudzilla_transaction_action\",\"join\");\n  }\n  return c;\n}\n\nList listTaxonomies = crud.add(\"parent_id\",id).call(getAppTaxonomies);\n\n\nif(preserveChildren.compareTo(\"true\") == 0){\n  Object appTaxonomy = attachTransaction(crud.add(\"id\",id)).call(getAppTaxonomy).get(0);\n  \n  //change the parent and root of the children of this node\n  for(Object taxonomyItem:listTaxonomies){\n      attachTransaction(crud\n        .add(\"id\",taxonomyItem.id)\n        .add(\"parent_id\",appTaxonomy.parentId)\n    \t.add(\"presibling_id\",taxonomyItem.preSiblingId))\n    \t.call(updateAppTaxonomyPosition);\n    \n      //update root pointer    \n      crud.add(\"old_apptaxonomy_id\",taxonomyItem.appTaxonomyId)\n          .add(\"apptaxonomy_id\",appTaxonomy.appTaxonomyId)\n    \t  .add(\"id\",taxonomyItem.id)\n          .call(updateAppTaxonomyRoot);\n  }\n}\nelse\n{\n  crud.logger().info(\"deleting taxonomy child item:\"+listTaxonomies.size());\n  for(Object taxonomyItem:listTaxonomies){\n    crud.logger().info(\"deleting taxonomy item:\"+taxonomyItem.name);\n    \n    if(taxonomyItem.type.compareTo(\"apptaxonomy-category\") == 0){\n      //recursive call to this script\n      crud.add(\"id\",taxonomyItem.id).call(deleteAppCategory);\n    }\n    else\n    {\n      attachTransaction(crud.add(\"id\",taxonomyItem.id)).call(deleteAppTaxonomy);\n      \n      //delete crud\n      attachTransaction(crud.add(\"definition_id\",taxonomyItem.linkId)).call(deleteCrudDefinition);\n    }\n  }\n}\n\nattachTransaction(crud.add(\"id\",id)).call(deleteAppTaxonomy);","name":"delete-category","description":"","crudType":"scriptexecutor","type":"groovy","serverSideOnly":"no","requireAllIdentities":null,"lastModifiedTimeStamp":"1392941106966"},"preexecution_handlers":[],"execution_parameters":[{"id":"ffcd5463-1e33-4ea1-9427-ee2441ae43f9","definitionId":"0fbb8848-48df-4380-ad7d-6b01bef06ebf","required":"no","name":"deleteAppCategory","type":"crud","validationRegEx":"","defaultValue":"/taxonomy/delete-category.ste","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"yes","position":"0"},{"id":"f8a44a8a-8793-4f34-84da-905b7121c0b0","definitionId":"0fbb8848-48df-4380-ad7d-6b01bef06ebf","required":"no","name":"getAppTaxonomies","type":"crud","validationRegEx":"","defaultValue":"../api/app-taxonomy/get-apptaxonomys.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"yes","position":"0"},{"id":"f5b0e14a-55f7-4448-ac92-d3c37035c5a3","definitionId":"0fbb8848-48df-4380-ad7d-6b01bef06ebf","required":"no","name":"preserveChildren","type":"string","validationRegEx":"","defaultValue":"false","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"no","position":"0"},{"id":"e436f7d7-71a3-4146-9925-3ef9c0f7ceee","definitionId":"0fbb8848-48df-4380-ad7d-6b01bef06ebf","required":"no","name":"deleteAppTaxonomy","type":"crud","validationRegEx":"","defaultValue":"../api/app-taxonomy/delete-apptaxonomy.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"yes","position":"0"},{"id":"c92dc05e-7df8-41a8-a126-95a2f0247906","definitionId":"0fbb8848-48df-4380-ad7d-6b01bef06ebf","required":"no","name":"deleteCrudDefinition","type":"crud","validationRegEx":"","defaultValue":"../api/primary-execution/crud-definition/delete-crud-definition.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"yes","position":"0"},{"id":"8cda33b6-abda-47d6-ba08-8320cf4bf6ff","definitionId":"0fbb8848-48df-4380-ad7d-6b01bef06ebf","required":"no","name":"preserveChildren","type":"string","validationRegEx":"","defaultValue":"false","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"no","position":"0"},{"id":"37237311-6126-46ab-907d-6c4b42158d31","definitionId":"0fbb8848-48df-4380-ad7d-6b01bef06ebf","required":"no","name":"updateAppTaxonomyRoot","type":"crud","validationRegEx":"","defaultValue":"../api/app-taxonomy/update-apptaxonomy-root.ste","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"yes","position":"0"},{"id":"339106e4-1b9b-4e82-9904-e674a8f87221","definitionId":"0fbb8848-48df-4380-ad7d-6b01bef06ebf","required":"no","name":"getAppTaxonomy","type":"crud","validationRegEx":"","defaultValue":"../api/app-taxonomy/get-apptaxonomy.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"yes","position":"0"},{"id":"0199db78-6106-41dd-a8ec-d16956e9b53f","definitionId":"0fbb8848-48df-4380-ad7d-6b01bef06ebf","required":"no","name":"updateAppTaxonomyPosition","type":"crud","validationRegEx":"","defaultValue":"../api/app-taxonomy/update-apptaxonomy-position.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"yes","position":"0"}],"reference_id":"f05d87d9-30d7-4ab2-971b-2495da0d114a","accesscontrols":[]}