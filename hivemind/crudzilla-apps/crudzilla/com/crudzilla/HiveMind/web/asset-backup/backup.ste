{"definition_id":"64687f77-05bd-489f-8bb6-5d2fe33610ee","last_refresh_timestamp":1378565148180,"postexecution_handlers":[],"definition":{"id":"64687f77-05bd-489f-8bb6-5d2fe33610ee","code":"import org.apache.commons.io.FileUtils;\nimport java.text.SimpleDateFormat;\nimport java.util.Date;\n\n\nString assetBaseDir = new File(crud.appBaseDir()+\"/\"+crudzilla.sysSettings().get(\"crudzilla_asset_base\")).getCanonicalPath();\nString snapShotBaseDir = assetBaseDir+\"/crudzilla-backup-snapshots\";\n\n//run backup\ncrud.add(\"snapShotDir\",snapShotBaseDir+\"/current\").call(\"take-snapshot.ste\");\n\n//roll current snapshot\nString lastestRollSnapShot = new SimpleDateFormat(\"yyyy.MM.dd-HH.mm.ss\").format(new Date());\nFileUtils.copyDirectory(new File(snapShotBaseDir+\"/current\"),new File(snapShotBaseDir+\"/\"+lastestRollSnapShot));\n\n//backup crudbase\nFile dbSnapShotFile = new File(snapShotBaseDir+\"/\"+lastestRollSnapShot+\"/\"+lastestRollSnapShot+\".derby\");\ncrud.add(\"snapShotPath\",dbSnapShotFile.getAbsolutePath()).call(\"crudbase-snapshot.stm\");\n","name":"backup","description":"","crudType":"scriptexecutor","type":"groovy","serverSideOnly":"no","requireAllIdentities":null,"lastModifiedTimeStamp":"1376586686060"},"preexecution_handlers":[],"execution_parameters":[],"reference_id":"a1bc919e-af40-4e09-97bb-f52a4d908250","accesscontrols":[]}