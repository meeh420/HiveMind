{"definition_id":"eee3800a-cd9a-4caa-b8d5-e6b66dc775a5","last_refresh_timestamp":1378565148404,"postexecution_handlers":[],"definition":{"id":"eee3800a-cd9a-4caa-b8d5-e6b66dc775a5","code":"import org.apache.commons.io.FileUtils;\nimport java.io.File;\nimport java.util.Date;\nimport java.text.SimpleDateFormat;\n\nString assetBaseDir = new File(crud.appBaseDir()+\"/\"+crudzilla.sysSettings().get(\"crudzilla_asset_base\")).getCanonicalPath();\nString snapShotBaseDir = assetBaseDir+\"/crudzilla-backup-snapshots\";\n\n//backup app assets\nFile[] files = new File(snapShotDir).listFiles();\nfor(File file:files){\n  if(file.isDirectory())\n  {\n     crud.add(\"snapShotDir\",file.getAbsolutePath()).call(\"take-snapshot.ste\"); \n  }\n  else\n  {\n     //get the current working version of this snapshot\n     File workingFile = new File(assetBaseDir+\"/\"+file.getAbsolutePath().substring((snapShotBaseDir+\"/current\").length()));\n     //first ensure it still exist\n     if(workingFile.exists()){\n       //take snapshot if working file has been modified since last backup\n       if(workingFile.lastModified()>file.lastModified()){\n         FileUtils.copyFile(workingFile,file);\n       }\n     }else{\n       file.delete();\n     }\n  }\n}\n\n","name":"take-snapshot","description":"","crudType":"scriptexecutor","type":"groovy","serverSideOnly":"yes","requireAllIdentities":null,"lastModifiedTimeStamp":"1376586686319"},"preexecution_handlers":[],"execution_parameters":[],"reference_id":"f2c2d59f-aa5e-4a1d-8cc2-235115a55288","accesscontrols":[]}