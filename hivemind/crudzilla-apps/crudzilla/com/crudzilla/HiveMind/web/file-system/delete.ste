{"definition_id":"fd189914-4618-4c04-8371-a29a1ba4ddab","last_refresh_timestamp":1380749324108,"postexecution_handlers":[],"definition":{"id":"fd189914-4618-4c04-8371-a29a1ba4ddab","code":"import java.util.Map;\nimport java.util.HashMap;\nimport com.crudzilla.platform.util.CrudzillaUtil;\nimport java.io.File;\nimport org.apache.commons.io.FileUtils;\nimport net.sf.json.JSONObject;\n\n\nMap returnVal = new HashMap();\n/*try{\n  //sync reference database and file system\n  //**this.sync(AssetFSManager.SYNC_ACTION_DELETE, getResourcePath());       \n}catch(Exception ex){\n  crud.logger().error(\"Error syncing database for \"+relPath,ex);\n}*/\n\nString fullPath = CrudzillaUtil.getFile(crudzilla,relPath).getAbsolutePath();\ncrud.logger().info(\"deleting  \"+fullPath);\n\nFile f = new File(fullPath);\nif(!f.isDirectory()){\n  \n  \n  if(relPath.endsWith(\".ste\")){\n    JSONObject refFile = JSONObject.fromObject(FileUtils.readFileToString(CrudzillaUtil.getFile(crudzilla,relPath)));\n    \n    if(refFile.get(\"definition\").getString(\"crudType\").compareTo(\"scriptexecutor\") == 0){\n      if(refFile.get(\"definition\").getString(\"type\").endsWith(\"velocity-template-file\")){\n        File codeFileToDel = CrudzillaUtil.getFile(crudzilla,relPath.substring(0,relPath.lastIndexOf(\".ste\"))+\".vm\");\n        codeFileToDel.delete();\n      }\n    }\n  }\n  \n  f.delete();\n  returnVal.put(\"status\", \"success\");\n}\nelse\n{\n  try\n  {\n    crud.logger().info(\"deleting directory \"+f.getAbsolutePath());\n    FileUtils.deleteDirectory(f);\n    returnVal.put(\"status\", \"success\");\n  }catch(Exception ex){\n    crud.logger().error(ex);\n    returnVal.put(\"status\", \"error\");\n  }\n}\nreturn returnVal;","name":"delete","description":"","crudType":"scriptexecutor","type":"groovy","serverSideOnly":"no","requireAllIdentities":"no","lastModifiedTimeStamp":"1380749322357"},"preexecution_handlers":[],"execution_parameters":[],"reference_id":"fb308fd9-cff4-44f5-9a65-c1b90c4455d6","accesscontrols":[]}