{"definition_id":"a206477d-714a-42af-a1da-9d2e6146be9b","last_refresh_timestamp":1389834193218,"postexecution_handlers":[],"definition":{"id":"a206477d-714a-42af-a1da-9d2e6146be9b","code":"import java.util.Map;\nimport java.util.HashMap;\nimport com.crudzilla.platform.util.CrudzillaUtil;\nimport java.io.File;\nimport org.apache.commons.io.FileUtils;\nimport net.sf.json.JSONObject;\n\nMap returnVal = new HashMap();\nString fromRelPath = fromRelPath;\nString toRelPath   = toRelPath;\n\nString newRelPath = toRelPath+\"/\"+fromRelPath.split(\"/\")[fromRelPath.split(\"/\").length-1];\n\nFile moveToDestParent = CrudzillaUtil.getFile(crudzilla,toRelPath);\nFile fileToMove       = CrudzillaUtil.getFile(crudzilla,fromRelPath);\nFile moveToDest       = CrudzillaUtil.getFile(crudzilla,newRelPath);\n\n//_logger.info(\"move: \"+fileToMove.getAbsolutePath()+\" -- \"+moveToDest.getAbsolutePath()+\" in \"+moveToDestParent.getAbsolutePath()+\"(\"+moveToDestParent.isDirectory()+\",\"+moveToDest.exists()+\")\");\n//don't support overwrite\nif(moveToDestParent.isDirectory() && !moveToDest.exists()){\n  try\n  {\n    \n    \n    if(fromRelPath.endsWith(\".ste\")){\n        JSONObject refFile = JSONObject.fromObject(FileUtils.readFileToString(fileToMove));\n      \n        if(refFile.get(\"definition\").getString(\"crudType\").compareTo(\"scriptexecutor\") == 0){\n          if(refFile.get(\"definition\").getString(\"type\").endsWith(\"velocity-template-file\")){\n              File codeFileToMove = CrudzillaUtil.getFile(crudzilla,fromRelPath.substring(0,fromRelPath.lastIndexOf(\".ste\"))+\".vm\");\n              FileUtils.moveToDirectory(codeFileToMove, moveToDestParent,false);\n          }\n        }\n    }\n    \n    FileUtils.moveToDirectory(fileToMove, moveToDestParent,false);\n    //**this.sync(AssetFSManager.SYNC_ACTION_UPDATE,newRelPath);\n    \n    returnVal.put(\"status\", \"success\");\n    returnVal.put(\"relPath\", newRelPath);\n    return returnVal;\n  }catch(java.io.IOException ex){\n    crud.logger().error(ex);\n  }\n}\nreturnVal.put(\"status\", \"error\");\nreturn returnVal;","name":"move","description":"","crudType":"scriptexecutor","type":"groovy","serverSideOnly":"no","requireAllIdentities":"no","lastModifiedTimeStamp":"1389834192202"},"preexecution_handlers":[],"execution_parameters":[],"reference_id":"bcbcbc81-fb67-4107-914f-cf5b83da6cb3","accesscontrols":[]}