{"definition_id":"ffe38980-75ab-43ae-8b46-09bb47ea669a","last_refresh_timestamp":1399134835373,"postexecution_handlers":[],"definition":{"id":"ffe38980-75ab-43ae-8b46-09bb47ea669a","code":"import java.util.Map;\nimport java.util.HashMap;\nimport com.crudzilla.platform.util.CrudzillaUtil;\nimport java.io.File;\nimport org.apache.commons.io.FileUtils;\n\n\ndef runCrud(){\n    Map returnVal = new HashMap();    \n    \n    Map<String,String> pathInfo = CrudzillaUtil.getPathInfo(crudzilla,relPath);\n    \n    String baseDir      = pathInfo.get(\"parentDir\");\n    String relPath      = pathInfo.get(\"relPath\");\n    String resourceName = pathInfo.get(\"resourceName\");\n    \n    if(pathInfo.get(\"missingPath\") != null){\n      new File(baseDir + \"/\"+pathInfo.get(\"missingPath\")).mkdirs();\n    }\n    \n    try\n    {\n      \n      if(mkdir != null || (mime != null && mime.compareTo(\"dir\")==0))\n        new File(baseDir+\"/\"+relPath).mkdir();\n      else\n      {\n        new File(baseDir+\"/\"+relPath).createNewFile();\n            \n        \n        if(relPath.endsWith(\".html\") && isUIPart != null && isUIPart.compareTo(\"true\")==0){\n            FileUtils.writeStringToFile(new File(baseDir+\"/\"+relPath), htmlUIPartTemplate);\n        }\n        else\n        if(relPath.endsWith(\".html\")){\n            FileUtils.writeStringToFile(new File(baseDir+\"/\"+relPath), htmlTemplate);\n        }\n      }\n      \n      returnVal.put(\"status\", \"success\");\n      Map appresource = new HashMap();\n      returnVal.put(\"appresource\", appresource);            \n      appresource.put(\"name\",resourceName);\n      return returnVal;\n    }catch(IOException ex){\n      crud.logger().error(ex);\n    }\n    returnVal.put(\"status\", \"error\");\n    return returnVal;\n}\n\nreturn runCrud();","name":"create","description":"","crudType":"scriptexecutor","type":"groovy","serverSideOnly":"no","requireAllIdentities":"no","lastModifiedTimeStamp":"1399134833402"},"preexecution_handlers":[],"execution_parameters":[{"id":"519e512c-7615-4c84-9c24-c204f0baf5f3","definitionId":"ffe38980-75ab-43ae-8b46-09bb47ea669a","required":"no","name":"mkdir","type":"string","validationRegEx":"","defaultValue":"","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"no","position":"0"},{"id":"5d9ed0d8-9269-49a7-8cca-7ed7638a20f8","definitionId":"ffe38980-75ab-43ae-8b46-09bb47ea669a","required":"no","name":"mime","type":"string","validationRegEx":"","defaultValue":"","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"no","position":"1"},{"id":"a770afd8-1b35-4ef2-b49b-8673037b6028","definitionId":"ffe38980-75ab-43ae-8b46-09bb47ea669a","required":"no","name":"htmlTemplate","type":"plain-text","validationRegEx":"","defaultValue":"<html lang=\"en\"><head>  \n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <meta name=\"description\" content=\"\">\n    <meta name=\"author\" content=\"\">\n    <link rel=\"shortcut icon\" href=\"static-assets/bootstrap/ico/favicon.ico\">\n\n    <title>UI<\/title>\n\n    <!-- Bootstrap core CSS -->\n    <link href=\"static-assets/bootstrap/css/bootstrap.min.css\" rel=\"stylesheet\">\n\n    <!-- Just for debugging purposes. Don't actually copy this line! -->\n    <!--[if lt IE 9]><script src=\"/static-assets/bootstrap/js/ie8-responsive-file-warning.js\"><\/script><![endif]-->\n\n    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->\n    <!--[if lt IE 9]>\n      <script src=\"https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js\"><\/script>\n      <script src=\"https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js\"><\/script>\n    <![endif]-->\n  <\/head>\n  <body> \n  <!-- Bootstrap core JavaScript\n    ================================================== --> \n  <!-- Placed at the end of the document so the pages load faster --> \n  <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js\"><\/script> \n  <script src=\"static-assets/bootstrap/js/bootstrap.min.js\"><\/script> \n   \n \n\n    \n<div draggable=\"true\" class=\"container\"> \n    <span><\/span><span><\/span><div draggable=\"true\" class=\"row\"> \n    <div class=\"col-sm-2\"><\/div><div class=\"col-sm-2\"><\/div><\/div><\/div>\n<\/body>\n<\/html>","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"2"},{"id":"a6980018-a25b-4405-89ce-c2cc56679cf4","definitionId":"ffe38980-75ab-43ae-8b46-09bb47ea669a","required":"no","name":"htmlUIPartTemplate","type":"plain-text","validationRegEx":"","defaultValue":"<html lang=\"en\"><head>  \n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <meta name=\"description\" content=\"\">\n    <meta name=\"author\" content=\"\">\n    <link rel=\"shortcut icon\" href=\"static-assets/bootstrap/ico/favicon.ico\">\n\n    <title>UI<\/title>\n\n    <!-- Bootstrap core CSS -->\n    <link href=\"static-assets/bootstrap/css/bootstrap.min.css\" rel=\"stylesheet\">\n\n    <!-- Just for debugging purposes. Don't actually copy this line! -->\n    <!--[if lt IE 9]><script src=\"/static-assets/bootstrap/js/ie8-responsive-file-warning.js\"><\/script><![endif]-->\n\n    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->\n    <!--[if lt IE 9]>\n      <script src=\"https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js\"><\/script>\n      <script src=\"https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js\"><\/script>\n    <![endif]-->\n    \n    <script type=\"text/javascript\">\n          document.crudzilla ={\n            part:\n            {\n              //this is required and should be a uuid\n              \"id\":\"f77a7d52-a866-11e3-b1d4-030027ab8d96\",\n              //define your external dependencies before declaring them on elements\n              external_dependencies:\n              {\n                \"https://github.com/twbs/bootstrap/releases/download/v3.1.1/bootstrap-3.1.1-dist.zip\":\n                {\n                  //url for downloading this dependency\n                  \"url\":\"https://github.com/twbs/bootstrap/releases/download/v3.1.1/bootstrap-3.1.1-dist.zip\",\n                  //a short one or two line \n                  \"description\":\"bootstrap CSS framework\",\n                  //name of this dependecy\n                  \"label\":\"Bootstrap\",\n                  //external page for any additional information about this dependency\n                  \"info_page\":\"http://getbootstrap.com/\",\n                  //where you want this to be placed within the current application, \n                  //if left blank, downloaded file would be place in the same directory \n                  //as active document.\n                  \"local_path\":\"/path/to/save/in\"\n                },\n                \"https://github.com/twbs/bootstrap/releases/download/v3.1.1/bootstrap-3.1.1-dist1.zip\":\n                {\n                  \"url\":\"https://github.com/twbs/bootstrap/releases/download/v3.1.1/bootstrap-3.1.1-dist.zip\",\n                  \"description\":\"bootstrap CSS framework\",\n                  \"label\":\"Bootstrap\",\n                  \"info_page\":\"http://getbootstrap.com/\",\n                  \"local_path\":\"/path/to/save/in\"\n                }               \n              }\n              ,\n             /*\n              * This interface checks the list of required dependencies and removes the ones that have already\n              * been met so user isn't prompted to install them. It can be implemented to check for dependencies\n              * in the active document in whatever means the developer deems suitable, the implementation below\n              * is just an example.\n              */\n              onCheckDependencies:function(requiredDependencies,activeDoc){\n                \n                //example implementation\n                for(var i=0;i<requiredDependencies.length;i++){\n                  var dependency = this.external_dependencies[requiredDependencies[i]];\n                  if(dependency.label == \"jquery\"){\n                    if(activeDoc.documentElement.ownerDocument.SomeJQueryVersion){\n                      //remove this dependency as it has been already met\n                      requiredDependencies.splice(i,1);\n                    }\n                  }\n                  else\n                  if(dependency.label == \"bootstrap\"){\n                    if(activeDoc.documentElement.ownerDocument.SomeBootstrapVersion){\n                      //remove this dependency as it has been already met\n                      requiredDependencies.splice(i,1);\n                    }\n                  }\n                  //...\n                  //...do something similar for other dependencies                  \n                }\n              },\n              /*\n               * Implement this interface if you want to handle the insertion of html elements\n               * when a drag-n-drop is performed. This interface would be called by the HiveMind\n               * UI builder if drag-n-drop is performed on an element that has the attribute\n               * data-crudzilla-call-ondrop defined and set to true.\n               */\n              onDrop:function(doc,dragElement,dropElement,callBack){\n                //This object describes a mutation to a document.\n                var mutation = \n                {\n                  //node to be added, removed or reparentd\n                  \"node\":nodeAddedRemovedOrReparented,\n                  //can be null\n                  \"oldParentNode\":null,\n                  //the parent that it added node was attached to\n                  \"newParentNode\":null,\n                  //can be null\n                  \"oldPreviousSibling\":null,\n                  //can be null if one isn't applicable\n                  \"oldNextSibling\":null,\n                  //where to drop an added node in relation to a particular sibling\n                  \"dropNextToNode\":\"none | left | right\",\n                  //specify if application\n                  \"newPreviousSibling\": null,\n                  //specify if applicable\n                  \"newNextSibling\" : null,\n                  //select on of these values to indicate the type of mutation to perform\n                  \"type\":\"added | removed | reparented\"\n                };           \n                //for all mutations to active document, notify HiveMind so mutation is persisted\n                //you may call this interface any time you make a persitent mutation to\n                //the active document. With out calling this interface, your changes would not\n                //become persistent so saving the active document would not capture your mutations.\n                this.onDocMutation(mutation,this.getActiveDoc());\n                \n                \n                //additionaly you can leverage the HiveMind UI builder in the implementation of\n                //this part. If you want the UI builder to enable drag-n-drop on an element that\n                //you inserted into this UI part's DOM, you can invoke onDocMutation with this UI part's\n                //document as follows:\n                this.onDocMutation(mutation,this.doc);\n              },\n              /*\n               * Called after an element is dragged from the UI Part document to the\n               * currently active document.\n               * @doc - refers the active document\n               */\n              onPostDrop:function(doc){                \n                //$(doc.crudzillaCloneDOM).find(\"*\").removeClass(this.classes.join(\" \"));                \n                doc.updatePair();\n                console.log(\"onPostDrop\");\n              },\n              /*\n               * Called after a new document is open in design mode, this opened document\n               * becomes the active document\n               * @doc - refers the active document\n               */              \n              onDocOpen:function(doc){\n                console.log(\"onDocOpen\");\n              },\n              /*\n               * Called when a document that is open in design mode is closed\n               * @doc - refers the closed document\n               */              \n              onDocClose:function(doc){\n                console.log(\"onDocClose\");\n              },\n              /*\n               * Called when a the tab an open document is activated, that is selected\n               * This document becomes the active document.\n               * @doc - refers the active document\n               */              \n              onDocTabActivate:function(doc){\n                console.log(\"onDocTabActivate\");\n              },              \n              /*\n               * Called when a the tab of active document is deactivated, \n               * that is another tab is selected               \n               * @doc - refers the active document\n               */            \n              onDocTabDeactivate:function(doc){\n                console.log(\"onDocTabDeactivate\");\n              }\n            }\n      };\n      \n      //register this ui part interface implementation \n      if(top.appBuilder)             \n        top.appBuilder.registerUIPart(document.crudzilla);    \n    <\/script>\n  <\/head>\n  <body> \n  <!-- Bootstrap core JavaScript\n    ================================================== --> \n  <!-- Placed at the end of the document so the pages load faster --> \n  <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js\"><\/script> \n  <script src=\"static-assets/bootstrap/js/bootstrap.min.js\"><\/script> \n   \n \n\n    \n<div draggable=\"true\" class=\"container\"> \n    <span><\/span><span><\/span><div draggable=\"true\" class=\"row\"> \n    <div class=\"col-sm-2\"><\/div><div class=\"col-sm-2\"><\/div><\/div><\/div>\n    \n    \n    <!--\n      This element depends on the stylesheet and script below as specified by its attributes. \n      Notice that it also depends on it self, this is how you tell the HiveMind UI builder to\n      drop this element when you do drag-n-drop operations. The order of the listed dependecy\n      determins how they are loaded.\n    -->\n    <div class=\"container\" data-crudzilla-depends-on=\"[data-crudzilla-part-component-id='ea6f5382-a153-11e3-b1d4-080027ab8d96'],[data-crudzilla-part-component-id='d433a756-a153-11e3-b1d4-080027ab8d96'],[data-crudzilla-part-component-id='c497400b-a153-11e3-b1d4-080027ab8d96']\" \n             data-crudzilla-part-component-id=\"d433a756-a153-11e3-b1d4-080027ab8d96\">\n    <\/div>\n\n    <!-- This stylesheet is depended upon by the container above -->\n    <style type=\"text/css\" data-crudzilla-part-component-id=\"ea6f5382-a153-11e3-b1d4-080027ab8d96\">\n\n    <\/style>\n\n    <!-- This script is depended upon by the container above -->\n    <script type=\"text/javascript\" data-crudzilla-part-component-id=\"c497400b-a153-11e3-b1d4-080027ab8d96\">\n\n    <\/script>    \n    \n    \n<\/body>\n<\/html>","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"3"},{"id":"bb9a0166-f8d3-4e18-876a-18d1463c45a7","definitionId":"ffe38980-75ab-43ae-8b46-09bb47ea669a","required":"no","name":"isUIPart","type":"string","validationRegEx":"","defaultValue":"","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"no","position":"4"}],"reference_id":"d32d1ac8-fbec-42a9-9cae-3db78afa695a","accesscontrols":[]}