{"definition_id":"80b94b74-5ae1-46d6-b2bb-19ebcd4630db","last_refresh_timestamp":1400892714900,"postexecution_handlers":[],"definition":{"id":"80b94b74-5ae1-46d6-b2bb-19ebcd4630db","code":"import org.apache.commons.beanutils.LazyDynaBean;\nimport com.crudzilla.platform.Crudzilla;\nimport com.crudzilla.platform.util.CrudzillaUtil;\nimport com.crudzilla.platform.datasource.bean.DataSource;\nimport org.apache.commons.io.FileUtils;\nimport com.crudzilla.platform.datastatement.bean.DataStatementReference;\nimport net.sf.json.JSONObject;\n\nString assetBaseDir = assetBaseDir = (new File(crud.appBaseDir()+\"/\"+crudzilla.sysSettings().get(\"crudzilla_asset_base\")).getCanonicalPath());\nCrudzilla tempCrudEngine = new Crudzilla(assetBaseDir+\"/\"+crudAppPath);\n\n\n//this is an advanced use example for what is basically inter-app interaction\n//we'll load the actual crud file since you can't run a crud across apps.\nObject rawCrud = JSONObject.fromObject(FileUtils.readFileToString(new File(assetBaseDir+\"/com/crudzilla/HiveMind/web/column-pooling/run-sql.stm\")));\n//hack\nrawCrud.get(\"definition\").remove(\"dataSourcePath\");\nDataStatementReference ref = new DataStatementReference(rawCrud,crud);\n\n//load datasource object\nLazyDynaBean dataSourceBean = tempCrudEngine.execute(new File(dataSource).getCanonicalPath(), CrudzillaUtil.newArgumentMap(tempCrudEngine,arguments),\"GET\",true, null);\nDataSource dataSrc = new DataSource();            \ndataSrc.setConfig(dataSourceBean);      \nref.getDataStatement().setDataSource(dataSrc);\n\n\n//establish a base path for executing this crud, all relative crud calls will\n//be resolved relative to this base path\nref.setBasePath(\"/column-pooling/run-sql.ste\");\n\nObject newCallMap = CrudzillaUtil.newArgumentMap(tempCrudEngine,arguments);\nnewCallMap.put(\"sql\",sql);\n//run datastament in correct engine\ncrud.call(ref,newCallMap);\n\n","name":"run-sql","description":"","crudType":"scriptexecutor","type":"groovy","serverSideOnly":"no","requireAllIdentities":"no","lastModifiedTimeStamp":"1400892714666"},"preexecution_handlers":[],"execution_parameters":[],"reference_id":"dc5b440f-ca1f-410f-803f-9fe26df91d61","accesscontrols":[]}