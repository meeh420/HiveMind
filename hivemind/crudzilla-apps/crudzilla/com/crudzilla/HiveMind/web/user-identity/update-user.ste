{"definition_id":"19fc4108-3869-45d0-bf1d-1adf3edd06e6","last_refresh_timestamp":1392684655310,"postexecution_handlers":[],"definition":{"id":"19fc4108-3869-45d0-bf1d-1adf3edd06e6","code":"def has(role,currentRoles){\n  for(Object currentRole : currentRoles){\n     if(currentRole.ROLE.compareToIgnoreCase(role) == 0) return true;\n  }  \n  return false;\n}\n\ndef newHas(role,newRoles){\n  for(String newRole : newRoles){\n     if(newRole.compareToIgnoreCase(role) == 0) return true;\n  }  \n  return false;\n}\n\n//get current roles\nObject currentRoles = crud.add(\"user_id\",user_id).call(\"get-users-roles.stm\");\n\n//update roles\nString[] newRoles = roles.split(\",\");\n\n//add new roles\nfor(String role:newRoles){\n  \n  if(!has(role,currentRoles))\n  {\n    Object roleObj = crud.add(\"role\",role).call(\"get-role-by-name.stm\");\n    \n    crud.add(\"user_id\",user_id)\n    .add(\"role_id\",roleObj.ID)\n    .call(\"add-user-role.stm\");    \n  }\n}\n\n//remove old roles\nfor(Object role:currentRoles){\n  \n  if(!newHas(role.ROLE,newRoles))\n  {\n    Object roleObj = crud.add(\"role\",role.ROLE).call(\"get-role-by-name.stm\");\n    \n    crud.add(\"user_id\",user_id)\n    .add(\"role_id\",roleObj.ID)\n    .call(\"delete-user-role.stm\");    \n  }\n}\n\n//change password if necessary\nif(pass_word != null && !pass_word.isEmpty()){\n\tcrud.add(\"pass_word\",pass_word)\n\t\t.add(\"user_id\",user_id)\n\t\t.call(\"change-password.stm\");\n}\n\n//update user full name\ncrud.add(\"name\",name)\n\t\t.add(\"user_id\",user_id)\n\t\t.call(\"update-user-fullname.stm\");\n\n//update user name\ncrud.add(\"user_name\",user_name)\n\t\t.add(\"user_id\",user_id)\n\t\t.call(\"change-username.stm\");\n\n//update part store access token\ncrud.add(\"part_store_access_token\",part_store_access_token)\n\t\t.add(\"user_id\",user_id)\n\t\t.call(\"update-part-store-access-token.stm\");\n","name":"update-user","description":"","crudType":"scriptexecutor","type":"groovy","serverSideOnly":"no","requireAllIdentities":"no","lastModifiedTimeStamp":"1392684654005"},"preexecution_handlers":[],"execution_parameters":[{"id":"a41b2296-fc99-4b4d-8c71-8b145e51106b","definitionId":"19fc4108-3869-45d0-bf1d-1adf3edd06e6","required":"no","name":"pass_word","type":"string","validationRegEx":"","defaultValue":"","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"no","position":"0"},{"id":"699977b7-c31f-4564-9b91-083923e079a2","definitionId":"19fc4108-3869-45d0-bf1d-1adf3edd06e6","required":"no","name":"part_store_access_token","type":"string","validationRegEx":"","defaultValue":"","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"no","position":"1"},{"id":"58942230-f7c7-4476-b8d2-95c0302085be","definitionId":"19fc4108-3869-45d0-bf1d-1adf3edd06e6","required":"no","name":"roles","type":"string","validationRegEx":"","defaultValue":"","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"no","position":"2"}],"reference_id":"7cb33d30-41a0-4aba-8dab-542d8cf3d7d6","accesscontrols":[]}