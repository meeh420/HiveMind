{"definition_id":"7ce69495-468a-4a29-9241-c7f7a053644f","last_refresh_timestamp":1400892675052,"postexecution_handlers":[],"definition":{"id":"7ce69495-468a-4a29-9241-c7f7a053644f","code":"  import com.crudzilla.platform.util.CrudzillaUtil;  \n\n  String pageName = \"test\";\n\n  Object pageTemplate = \n  crud.add(\"createPath\",\"false\")\n  .add(\"taxonomyPath\",\"com/crudzilla/HiveMind/web/html-layout/bookmarks/bookmark-type-template\")\n  .add(\"parent_id\",\"0\")\n  .call(findAppTaxonomy);\n  \n  \n  String pageId = crud\n  .add(\"definition_id\",pageTemplate.linkId)\n  .add(\"name\",pageName)\n  .add(\"crudzilla_id_value\", \"\")\n  .add(\"crudzilla_url_value\", pageUrl)\n  .add(\"crudzilla_label_value\",pageLabel != null && !pageLabel.trim().isEmpty()?pageLabel:pageUrl)\n  .call(cloneCrudDefinition);\n  pageName = pageId;\n\n  crud.add(\"definitionId\",pageId)\n    .add(\"name\",\"id\")\n    .add(\"defaultValue\",pageId)\n    .call(updateParameter);\n\n  //update page name\n  crud.add(\"id\",pageId)\n\t.add(\"name\",pageName)\n\t.call(updateInstantiatorName);\n \n\n  \n\n  //add it to the right category\n  Object pageList = crud.add(\"createPath\",\"true\")\n  .add(\"taxonomyPath\",\"com/crudzilla/HiveMind/web/html-layout/bookmarks/pages\")\n  .add(\"parent_id\",\"0\")\n  .call(findAppTaxonomy);\n  \n  List definedPages = crud.add(\"parent_id\",pageList.id).call(getAppTaxonomies);\n  \n  Object lastItem = null;\n  Map preSiblings = new HashMap();\n  for(Object obj:definedPages)\n     preSiblings.put(obj.preSiblingId,obj.preSiblingId);\n  \n  for(Object obj:definedPages){\n    //if this obj's id isn't a presibling, it is the last item\n    if(preSiblings.get(obj.id) == null){\n      lastItem = obj;\n      break;\n    }\n  }\n  \n  crud\n  .add(\"apptaxonomy_id\",pageList.appTaxonomyId)\n  .add(\"parent_id\",pageList.id)\n  .add(\"presibling_id\",lastItem != null?lastItem.id:\"-1\")\n  .add(\"link_id\",pageId)\n  .add(\"link_apptaxonomy_id\",\"-1\")\n  .add(\"type\",pageTemplate.type)\n  .add(\"name\",pageName)\n  .call(addAppTaxonomy);\n  \n  //add entry to app list\n  Object pageListEntries = crud.add(\"createPath\",\"false\")//\n   \t\t\t\t\t\t\t  .add(\"parent_id\",\"0\")\n  \t\t\t\t\t\t\t  .add(\"taxonomyPath\",\"com/crudzilla/HiveMind/web/html-layout/bookmarks/page-list\")\n  \t\t\t\t\t\t\t .call(findAppTaxonomy);\n  crud\n  .add(\"definitionId\",pageListEntries.linkId)\n  .add(\"defaultValue\",\"pages/\"+pageName+\".ins\")\n  .add(\"name\",\"\")\n  .add(\"type\",\"crud\")\n  .add(\"evalRight\",\"yes\")\n  .add(\"isFinal\",\"yes\")\n  .add(\"position\",crud.call(\"/html-layout/bookmarks/page-list.ins\").size())\n  .call(addParameter);\n\n\n  //bake the page list to reflect update\n  crud.add(\"relPath\",\"com/crudzilla/HiveMind/web/html-layout/bookmarks/page-list\")\n  .add(\"parent_id\",\"0\")\n  .call(bakeCrud);\n\n  crud.add(\"relPath\",\"com/crudzilla/HiveMind/web/html-layout/bookmarks/pages/\"+pageName)\n  .add(\"parent_id\",\"0\")\n  .call(bakeCrud);\n\n  //flush page list from cache\n  crudzilla.inValidateCrudCache(CrudzillaUtil.getCrudFile(crudzilla,\"/html-layout/bookmarks/page-list.ins\").getCanonicalPath());  \n\n\n return pageId;","name":"add-page","description":"","crudType":"scriptexecutor","type":"groovy","serverSideOnly":"no","requireAllIdentities":"no","lastModifiedTimeStamp":"1400892674881"},"preexecution_handlers":[],"execution_parameters":[{"id":"5b0598a6-ac1c-4e67-93c9-6967c5b7e50c","definitionId":"7ce69495-468a-4a29-9241-c7f7a053644f","required":"no","name":"cloneCrudDefinition","type":"string","validationRegEx":"","defaultValue":"/api/primary-execution/crud-definition/clone-crud-definition.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"0"},{"id":"610637aa-d8bd-4ee9-be9b-dbf2e78f22bc","definitionId":"7ce69495-468a-4a29-9241-c7f7a053644f","required":"no","name":"findAppTaxonomy","type":"string","validationRegEx":"","defaultValue":"/taxonomy/find-category.ste","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"1"},{"id":"bf88a703-5e20-40c9-9196-4d5678a4a419","definitionId":"7ce69495-468a-4a29-9241-c7f7a053644f","required":"no","name":"bakeCrud","type":"string","validationRegEx":"","defaultValue":"/taxonomy/bake-crud.ste","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"2"},{"id":"963f55b9-4ebe-46d3-bad0-4b81a5a057a8","definitionId":"7ce69495-468a-4a29-9241-c7f7a053644f","required":"no","name":"addAppTaxonomy","type":"string","validationRegEx":"","defaultValue":"/api/app-taxonomy/add-apptaxonomy.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"3"},{"id":"481a2f0b-18c1-4e6e-8286-31cbf4f453fb","definitionId":"7ce69495-468a-4a29-9241-c7f7a053644f","required":"no","name":"addParameter","type":"string","validationRegEx":"","defaultValue":"/api/nvp-processing/add-execution-parameter.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"4"},{"id":"6103e412-39f1-442d-806f-2c9ca27b24f1","definitionId":"7ce69495-468a-4a29-9241-c7f7a053644f","required":"no","name":"getAppTaxonomies","type":"string","validationRegEx":"","defaultValue":"/api/app-taxonomy/get-apptaxonomys.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"5"},{"id":"5962e809-f275-4f47-b73a-2ec49d481bd1","definitionId":"7ce69495-468a-4a29-9241-c7f7a053644f","required":"no","name":"pageLabel","type":"string","validationRegEx":"","defaultValue":"","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"no","position":"6"},{"id":"9a73d366-23e6-42fb-b874-1cb646fc3498","definitionId":"7ce69495-468a-4a29-9241-c7f7a053644f","required":"no","name":"updateParameter","type":"string","validationRegEx":"","defaultValue":"/api/nvp-processing/update-execution-parameter-value-by-name.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"7"},{"id":"0ec569ed-320f-4d1e-a3b0-d6965efd72bb","definitionId":"7ce69495-468a-4a29-9241-c7f7a053644f","required":"no","name":"updateAppTaxonomyName","type":"string","validationRegEx":"","defaultValue":"/api/app-taxonomy/update-apptaxonomy-name.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"8"},{"id":"e0b931b2-b5de-429f-a1f6-e3654b264d80","definitionId":"7ce69495-468a-4a29-9241-c7f7a053644f","required":"no","name":"updateInstantiatorName","type":"string","validationRegEx":"","defaultValue":"/api/primary-execution/instantiator/update-instantiator-name.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"9"}],"reference_id":"66c1ceb5-bc1c-405c-9420-75184dca8eee","accesscontrols":[]}