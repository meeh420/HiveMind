{"definition_id":"84e93a12-ba45-424e-b899-33a91e76919e","last_refresh_timestamp":1394313985053,"postexecution_handlers":[],"definition":{"id":"84e93a12-ba45-424e-b899-33a91e76919e","code":"import java.io.FileInputStream;\nimport java.io.ByteArrayOutputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.OutputStream;\nimport java.io.File;\nimport org.apache.derby.tools.ij;\nimport com.crudzilla.http.proxy.ProxyServlet;\nimport com.crudzilla.platform.Crudzilla;\n\n//set system dir\nSystem.setProperty(\"derby.system.home\",System.getProperty(\"jetty.home\")/*+\"/derby\"*/);\n\n//initialize derby engine\narguments.put(\"dataSourceConfig\",crud.call(derbyConnection));\nObject conn = crud.resolvePathToCaller(crudzilla.sysSettings().get(\"crudzilla_datasource_connection_creator\").toString()).call(crudzilla.sysSettings().get(\"crudzilla_datasource_connection_creator\"), arguments);\n\nObject engine = crudzilla;\nnew Thread(new Runnable(){\n  public void run(){\n    Map arguments = new HashMap<String,Object>();\n    engine.execute(\"/lucene/start-lucene.ste\",arguments,true,null);\n  }\n}).start();\n\nProxyServlet.configure(\"crudzilla-part-store\",crud.call(\"/crudzilla-app-settings/crudzilla-http-proxy.ins\"));\nProxyServlet.configure(\"all\",crud.call(\"/crudzilla-app-settings/all-http-proxy.ins\"));\n\n/*           \ntry \n{ \n    //Object crudDefDb = crud.call(crudDefinitionDatabase);    \n    OutputStream os = new ByteArrayOutputStream();\n  \n\tInputStream  is = new FileInputStream(new File(crud.appBaseDir()+\"/crud-web-app-dependencies/cwab-extra/tables.sql\"));  \n  \tij.runScript(conn,is,\"utf-8\",os,\"utf-8\");\n    \n\t//is = new FileInputStream(new File(crud.appBaseDir()+\"/crud-web-app-dependencies/cwab-extra/crud-data.sql\"));  \n  \t//ij.runScript(conn,is,\"utf-8\",os,\"utf-8\");  \n  \n    crud.logger().info(os.toString());  \n}catch (Throwable e)  {\n    crud.logger().error(e);\n}*/\n\n//start asset directory file backup monitor\n","name":"on-engine-startup","description":"","crudType":"scriptexecutor","type":"groovy","serverSideOnly":"no","requireAllIdentities":null,"lastModifiedTimeStamp":"1394313984163"},"preexecution_handlers":[],"execution_parameters":[{"id":"3fdac54f-8bd5-4a3b-a57b-142c42f1426f","definitionId":"84e93a12-ba45-424e-b899-33a91e76919e","required":"no","name":"derbyConnection","type":"crud","validationRegEx":null,"defaultValue":"derby.ins","maxLength":null,"minLength":null,"lineEndLength":null,"maxRange":null,"minRange":null,"dateFormat":null,"dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":null,"evalLeft":"no","evalRight":"no","keepAliveCount":"","isFinal":"yes","position":"0"}],"reference_id":"fedd2049-1eb9-4cbd-9845-af94c66b128f","accesscontrols":[]}