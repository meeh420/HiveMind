{"definition_id":"d41b96ce-8929-4c66-989b-8659cd6e551e","last_refresh_timestamp":1391219908987,"postexecution_handlers":[],"definition":{"id":"d41b96ce-8929-4c66-989b-8659cd6e551e","code":"import java.util.Map;\nimport java.util.HashMap;\n\n//get datamodel category\nObject dataModelCategory = crud.add(\"id\",id)\n.add(\"crudzillaResultSetFormat\",\"bean\")\n.call(getAppTaxonomy);\n\n\n//update datamodel name\ncrud.add(\"id\",dataModelCategory.id)\n\t.add(\"name\",dataModelName)\n\t.call(updateAppTaxonomyName);\n\n\n//get datamodel object\nObject dataModelTaxonomy = \ncrud.add(\"taxonomyPath\", relPath+\"/\"+dataModelName+\"/datamodel\").call(findAppTaxonomy);\n\n\ncrud.add(\"definitionId\",dataModelTaxonomy.linkId)\n    .add(\"name\",\"name\")\n    .add(\"defaultValue\",dataModelName)\n    .call(updateParameter);\n\ncrud.add(\"definitionId\",dataModelTaxonomy.linkId)\n    .add(\"name\",\"alias\")\n    .add(\"defaultValue\",dataModelAlias)\n    .call(updateParameter);\n\ncrud.add(\"definitionId\",dataModelTaxonomy.linkId)\n    .add(\"name\",\"typeIdentifier\")\n    .add(\"defaultValue\",dataModelIdentifier)\n    .call(updateParameter);\n\ncrud.add(\"definitionId\",dataModelTaxonomy.linkId)\n    .add(\"name\",\"dataTable\")\n    .add(\"defaultValue\",dataModelDataTable)\n    .call(updateParameter);\n\n\ncrud.add(\"relPath\",relPath+\"/\"+dataModelCategory.name)\n\t.add(\"name\",dataModelName)\n\t.call(\"/file-system/rename.ste\");\n\n\n//delete deleted fields\n\nif(!deleteQueue.isEmpty()){\n  String[] delIds = deleteQueue.split(',');\n  for(String fid:delIds){\n    crud.add(\"id\",fid)\n      .add(\"relPath\",relPath+\"/\"+dataModelName)\n      .call(\"delete-field.ste\");\n  }\n}\n   \nMap addedField = new HashMap();\n\n//update fields\nfor(int i=0;i<fieldCount;i++){\n  String fieldId = \n  crud\n  .add(\"id\",arguments.get(\"dataModelFieldId\"+i))\n  .add(\"name\",arguments.get(\"dataModelField\"+i))\n  .add(\"column\",arguments.get(\"dataModelFieldColumn\"+i))\n  .add(\"useAsLabel\",arguments.get(\"dataModelFieldUseAsLabel\"+i))\n  .add(\"relPath\",relPath+\"/\"+dataModelName)\n  .call(\"update-field.ste\");\n  \n  if(fieldId != null)\n    addedField.put(arguments.get(\"dataModelFieldId\"+i),fieldId);  \n}\n\ncrud.add(\"relPath\",relPath+\"/\"+dataModelName+\"/datamodel\").call(\"/taxonomy/bake-crud.ste\");\n\nreturn addedField;","name":"update-datamodel","description":"","crudType":"scriptexecutor","type":"groovy","serverSideOnly":"no","requireAllIdentities":"no","lastModifiedTimeStamp":"1391219908368"},"preexecution_handlers":[],"execution_parameters":[{"id":"c5f3b17e-9f6d-4cee-b148-d7590cf4f3f7","definitionId":"d41b96ce-8929-4c66-989b-8659cd6e551e","required":"no","name":"fieldCount","type":"integer","validationRegEx":"","defaultValue":"","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"no","position":"0"},{"id":"31861dec-476b-4e2f-aeaf-5d428ad3b643","definitionId":"d41b96ce-8929-4c66-989b-8659cd6e551e","required":"no","name":"updateAppTaxonomyName","type":"string","validationRegEx":"","defaultValue":"/api/app-taxonomy/update-apptaxonomy-name.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"1"},{"id":"e47ab761-a417-4909-9111-51313ed768d5","definitionId":"d41b96ce-8929-4c66-989b-8659cd6e551e","required":"no","name":"findAppTaxonomy","type":"string","validationRegEx":"","defaultValue":"/taxonomy/find-category.ste","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"2"},{"id":"6e041d5e-d3da-4e4a-820e-136cc52e1f19","definitionId":"d41b96ce-8929-4c66-989b-8659cd6e551e","required":"no","name":"updateParameter","type":"string","validationRegEx":"","defaultValue":"/api/nvp-processing/update-execution-parameter-value-by-name.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"3"},{"id":"d04b2738-366a-4f3c-bd9f-cea519b48a57","definitionId":"d41b96ce-8929-4c66-989b-8659cd6e551e","required":"no","name":"getAppTaxonomy","type":"string","validationRegEx":"","defaultValue":"/api/app-taxonomy/get-apptaxonomy.stm","maxLength":"","minLength":"","lineEndLength":"","maxRange":"","minRange":"","dateFormat":"","dateFormatStrict":"no","allowallschemesForURL":"no","allow2slashesForURL":"no","nofragmentsForURL":"no","schemesForURL":"","evalLeft":"no","evalRight":"no","keepAliveCount":null,"isFinal":"yes","position":"4"}],"reference_id":"fae9d6fe-c976-4444-8d41-3e377622af9f","accesscontrols":[]}